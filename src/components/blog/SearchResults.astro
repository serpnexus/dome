---
// src/components/SearchResults.astro - Search results
import { searchPosts, getFeaturedImage, formatDate } from '../../lib/wordpress.js';

const { query } = Astro.props;
let searchResults = null;
let loading = false;

if (query) {
  loading = true;
  searchResults = await searchPosts(query, 'post,page');
  loading = false;
}
---

<div id="search-results">
  {loading && (
    <div class="text-center py-8">
      <div class="animate-spin h-8 w-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto"></div>
      <p class="text-gray-600 mt-2">Searching...</p>
    </div>
  )}
  
  {query && searchResults && (
    <div>
      <p class="text-gray-600 mb-6">
        Found {searchResults.found} results for "<strong>{query}</strong>"
      </p>
      
      {searchResults.results && searchResults.results.length > 0 ? (
        <div class="space-y-6">
          {searchResults.results.map((result: { featured_image: string | null | undefined; url: string | URL | null | undefined; title: unknown; date: any; excerpt: unknown; }) => (
            <article class="border-b pb-6 last:border-b-0">
              <div class="flex space-x-4">
                {result.featured_image && (
                  <div class="flex-shrink-0">
                    <img 
                      src={result.featured_image}
                      alt=""
                      class="w-20 h-20 object-cover rounded"
                    />
                  </div>
                )}
                
                <div class="flex-1">
                  <h3 class="text-xl font-semibold mb-2">
                    <a 
                      href={result.url}
                      class="hover:text-blue-600 transition-colors"
                      set:html={result.title}
                    />
                  </h3>
                  
                  <p class="text-gray-600 text-sm mb-2">
                    {formatDate(result.date)}
                  </p>
                  
                  <div class="text-gray-700" set:html={result.excerpt} />
                </div>
              </div>
            </article>
          ))}
        </div>
      ) : (
        <div class="text-center py-12">
          <p class="text-gray-600">No results found for your search.</p>
          <p class="text-gray-500 mt-2">Try using different keywords or check your spelling.</p>
        </div>
      )}
    </div>
  )}
  
  {!query && (
    <div class="text-center py-12 text-gray-500">
      <p>Enter a search term to find posts and pages.</p>
    </div>
  )}
</div>